<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FixNull - Productos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="./css/styles.css">
  

</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo">
                <a href="index.html">
                <i class="fas fa-microchip"></i>
                <span>FixNull</span>
            </a></div>
      <button class="mobile-menu-btn" id="menuBtn"><i class="fas fa-bars"></i></button>
      <nav id="mainNav">
        <ul>
          <li><a href="index.html#inicio">Inicio</a></li>
          <li><a href="products.html" class="active">Productos</a></li>
          <li><a href="index.html#servicios">Servicios</a></li>
          <li><a href="index.html#testimonios">Testimonios</a></li>
          <li><a href="index.html#contacto">Contacto</a></li>
          <li id="loginMenuItem"><a href="login.html">Login</a></li>
          <li id="invMenuItem" style="display:none;"><a href="inventory.html">Inventario</a></li>
        </ul>
      </nav>
      <a href="https://wa.me/1234567890" class="whatsapp-contact" target="_blank">
                <i class="fab fa-whatsapp"></i> WhatsApp
            </a>
    </div>
  </header>

  <div class="products-page">
    <aside class="filter-panel">
      <div class="filter-header">
        <h3>Filtrar</h3>
        <span id="categoryCount" class="category-badge">0 categorías</span>
      </div>
      <div class="filter-group"><label for="searchName">Nombre</label><input type="text" id="searchName" placeholder="Buscar por nombre..."></div>
      <div class="filter-group"><label for="filterCategory">Categoría</label><select id="filterCategory"><option value="all">Todas las categorías</option></select></div>
      <div class="filter-group"><label>Precio</label><div class="price-range"><input type="number" id="minPrice" placeholder="Mín" step="0.01"><input type="number" id="maxPrice" placeholder="Máx" step="0.01"></div></div>
      <div class="filter-group"><div class="filter-check"><input type="checkbox" id="filterOnSale"><label for="filterOnSale">Solo en oferta</label></div></div>
      <button id="clearFilters">Limpiar filtros</button>
      <div class="sync-info"><h4>Sincronización en tiempo real</h4><p>Actualizacion constante de cambios de productos.</p></div>
    </aside>
    <section class="products-list" id="productsList"></section>
  </div>

  <div class="sync-status" id="syncStatus"><i class="fas fa-sync-alt"></i><span>Ofertas Nuevas todos los días!!</span></div>
  <div class="notification" id="notification"><i class="fas fa-check-circle success"></i><div class="notification-content"><h4>Inventario Actualizado</h4><p>Las categorías se han sincronizado</p></div></div>


  <div class="product-modal-overlay" id="productModalOverlay">
    <div class="product-modal-content" id="productModalContent">
      <button class="product-modal-close" id="closeModalBtn">&times;</button>
      
      <div class="modal-product-header">
        <h3 id="modalProductName"></h3>
        <div class="modal-category-badge" id="modalProductCategory"></div>
      </div>
      
      <div class="modal-product-container">
        <div class="modal-image-container">
          <img id="modalProductImage" src="" alt="Producto">
          <div class="modal-badges" id="modalBadges"></div>
        </div>
        
        <div class="modal-info-container">
          <div class="modal-description">
            <p id="modalProductDescription"></p>
          </div>
          
          <div class="modal-price-section">
            <div class="modal-price-group">
              <i class="fas fa-box"></i>
              <span id="modalOriginalPrice" class="original-price"></span>
              <span id="modalCurrentPrice" class="current-price"></span>
              <div id="modalDiscountBadge" class="discount-badge"></div>
            </div>
                       
          </div>
          
          <div class="modal-actions">
            <button class="modal-buy-btn" id="modalBuyBtn">
              <i class="fab fa-whatsapp"></i> Comprar por WhatsApp
            </button>
            <button class="modal-wishlist-btn" id="wishlistBtn">
              <i class="far fa-heart"></i> Guardar en lista
            </button>
          </div>
        </div>
      </div>
      
      <div class="modal-specs" id="modalSpecs">
        <!-- Spacio en el POPover para cualquier uso -->
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('productos.json')
        .then(res => res.json())
        .then(data => {
          localStorage.setItem('inventory', JSON.stringify(data));
          initApp();
        })
        .catch(err => {
          console.warn('Fetch productos.json falló, usando inventario local:', err);
          initApp();
        });
    });

    function initApp() {
      updateCategoryFilter();
      filterProducts();
      setupFilters();
      setupMenuAndWhatsApp();
    }

    function getInventory() {
      const inv = localStorage.getItem('inventory');
      return inv ? JSON.parse(inv) : [];
    }

    function updateCategoryFilter() {
      const inventory = getInventory();
      const categorySelect = document.getElementById('filterCategory');
      const categories = [...new Set(inventory.map(item => item.category))];

      const count = categories.length;
      document.getElementById('categoryCount').textContent = 
      `${count} categoría${count !== 1 ? 's' : ''}`;
      document.getElementById('categoryCount').textContent = `${categories.length} categorías`;
      const current = categorySelect.value;
      categorySelect.innerHTML = '<option value="all">Todas las categorías</option>';
      categories.forEach(cat => {
        const o = document.createElement('option'); o.value = cat; o.textContent = cat; categorySelect.appendChild(o);
      });
      if(categories.includes(current)) categorySelect.value = current;
    }

    function renderProducts(list) {
  const productsList = document.getElementById('productsList');
  productsList.innerHTML = '';
  
  if (!list.length) {
    productsList.innerHTML = `
      <div style="grid-column:1/-1;text-align:center;padding:3rem;">
        <i class="fas fa-box-open" style="font-size:3rem;color:#cbd5e0;margin-bottom:1rem;"></i>
        <h3 style="font-family:'Montserrat';color:var(--secondary);margin-bottom:0.5rem;">No se encontraron productos</h3>
        <p style="color:var(--gray);">Intenta ajustar tus filtros</p>
      </div>
    `;
    return;
  }
  
  list.forEach((item, index) => {
      const card = document.createElement('div');
      card.className = 'product-card';
      
      // Generar HTML para precios con estilos diferenciados
      const priceHTML = item.onSale 
        ? `<span class="original-price">S/.${item.price.toFixed(2)}</span><span class="sale-price">S/.${item.salePrice.toFixed(2)}</span>`
        : `S/.${item.price.toFixed(2)}`;
      
      card.innerHTML = `
        ${item.onSale ? '<span class="sale-badge">Oferta</span>' : ''}
        ${index > 3 ? '<span class="new-badge">Nuevo</span>' : ''}
        <div class="product-image">
          <img src="${item.imgUrl || 'https://via.placeholder.com/300x180?text=Sin+imagen'}" alt="${item.name}">
        </div>
        <div class="product-info">
          <h4>${item.name}</h4>
          <p>${item.description}</p>
          <div class="price-group">${priceHTML}</div>
        </div>
      `;
      
      card.addEventListener('click', () => openProductModal(item));
      productsList.appendChild(card);
    });
  }

    function filterProducts() {
      const name = document.getElementById('searchName').value.toLowerCase();

     

      const cat = document.getElementById('filterCategory').value;
      const min = parseFloat(document.getElementById('minPrice').value)||0;
      const max = parseFloat(document.getElementById('maxPrice').value)||Infinity;
      const onSale = document.getElementById('filterOnSale').checked;
      const inv = getInventory();
      const out = inv.filter(item=>{
        if(name&&!item.name.toLowerCase().includes(name))return false;
        
        if(cat!=='all'&&item.category!==cat) return false;
        if(item.price<min||item.price>max) return false;
        if(onSale&&!item.onSale) return false;
        return true;
      });
      renderProducts(out);
    }

    function setupFilters() {
      ['searchName','filterCategory','minPrice','maxPrice','filterOnSale'].forEach(id=>{
        document.getElementById(id).addEventListener(id==='filterCategory'||id==='filterOnSale'?'change':'input',filterProducts);
      });
      document.getElementById('clearFilters').addEventListener('click',()=>{
        ['searchName','minPrice','maxPrice'].forEach(i=>document.getElementById(i).value='');
        document.getElementById('filterCategory').value='all';
        document.getElementById('filterOnSale').checked=false;
        filterProducts();
      });
    }

    function setupMenuAndWhatsApp() {
      const menuBtn = document.getElementById('menuBtn');
      const nav = document.getElementById('mainNav');
      
      menuBtn.addEventListener('click', () => {
        nav.classList.toggle('active');
        menuBtn.innerHTML = nav.classList.contains('active') 
          ? '<i class="fas fa-times"></i>' 
          : '<i class="fas fa-bars"></i>';
      });

      // Cerrar menú al hacer clic en un enlace
      document.querySelectorAll('nav a').forEach(link => {
        link.addEventListener('click', () => {
          nav.classList.remove('active');
          menuBtn.innerHTML = '<i class="fas fa-bars"></i>';
        });
      });
    }

    const notification=document.getElementById('notification');
    function showNotification(msg) {
      const notification = document.getElementById('notification');
      notification.querySelector('.notification-content h4').textContent = msg;
      
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function openProductModal(product) {
      // Configurar imagen
      const imgElement = document.getElementById('modalProductImage');
      imgElement.src = product.imgUrl || 'https://via.placeholder.com/500x500?text=Sin+imagen';
      imgElement.alt = product.name;
      
      // Configurar nombre y categoría
      document.getElementById('modalProductName').textContent = product.name;
      document.getElementById('modalProductCategory').textContent = product.category;
      
      // Configurar descripción
      document.getElementById('modalProductDescription').textContent = product.description;
      
      // Configurar precios y descuento
      const origPriceElem = document.getElementById('modalOriginalPrice');
      const currentPriceElem = document.getElementById('modalCurrentPrice');
      const discountBadgeElem = document.getElementById('modalDiscountBadge');
      
      if (product.onSale) {
        origPriceElem.textContent = `S/.${product.price.toFixed(2)}`;
        origPriceElem.style.display = 'inline';
        
        currentPriceElem.textContent = `S/.${product.salePrice.toFixed(2)}`;
        currentPriceElem.className = 'current-price sale-price';
        
        // Calcular porcentaje de descuento
        const discount = Math.round(((product.price - product.salePrice) / product.price) * 100);
        discountBadgeElem.textContent = `-${discount}%`;
        discountBadgeElem.style.display = 'block';
      } else {
        origPriceElem.style.display = 'none';
        discountBadgeElem.style.display = 'none';
        currentPriceElem.textContent = `S/.${product.price.toFixed(2)}`;
        currentPriceElem.className = 'current-price';
      }
      
      // Configurar badges (oferta, nuevo)
      const badgesContainer = document.getElementById('modalBadges');
      badgesContainer.innerHTML = '';
      
      if (product.onSale) {
        const saleBadge = document.createElement('span');
        saleBadge.className = 'sale-badge';
        saleBadge.textContent = 'Oferta';
        badgesContainer.appendChild(saleBadge);
      }
      
      if (product.isNew) {
        const newBadge = document.createElement('span');
        newBadge.className = 'new-badge';
        newBadge.textContent = 'Nuevo';
        badgesContainer.appendChild(newBadge);
      }
      
      // Configurar stock (ejemplo)
      //const stockStatusElem = document.getElementById('modalStockStatus');
      //if (product.stock > 10) {
      //  stockStatusElem.textContent = 'En stock';
      //  stockStatusElem.className = 'stock-high';
      //} else if (product.stock > 0) {
      //  stockStatusElem.textContent = `Últimas ${product.stock} unidades`;
      //  stockStatusElem.className = 'stock-medium';
      //} else {
      //  stockStatusElem.textContent = 'Agotado';
      //  stockStatusElem.className = 'stock-low';
      //}
      
      // Configurar especificaciones (si existen)
      const specsContainer = document.getElementById('modalSpecs');
      if (product.specs) {
        specsContainer.innerHTML = '<h4>Especificaciones:</h4>';
        const specsList = document.createElement('ul');
        
        product.specs.forEach(spec => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${spec.name}:</strong> ${spec.value}`;
          specsList.appendChild(li);
        });
        
        specsContainer.appendChild(specsList);
      } else {
        specsContainer.innerHTML = '';
      }
      
      // Configurar botón de WhatsApp
      document.getElementById('modalBuyBtn').onclick = () => {
        const message = encodeURIComponent(`Hola, estoy interesado en el producto: ${product.name} - ${window.location.href}`);
        window.open(`https://wa.me/51989530163?text=${message}`, '_blank');
      };
      
      // Mostrar modal
      document.getElementById('productModalOverlay').classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    document.getElementById('closeModalBtn').addEventListener('click',closeProductModal);
    document.getElementById('productModalOverlay').addEventListener('click',e=>{ if(e.target.id==='productModalOverlay') closeProductModal(); });

    function closeProductModal(){ document.getElementById('productModalOverlay').classList.remove('show'); document.body.style.overflow=''; }

    window.addEventListener('storage',e=>{ if(e.key==='inventory'){ updateCategoryFilter(); filterProducts(); showNotification('Inventario actualizado'); } });

    // Inicial admin menu state
    document.addEventListener('DOMContentLoaded',()=>{
      if(sessionStorage.getItem('isAdmin')==='true'){ document.getElementById('invMenuItem').style.display='block'; document.getElementById('loginMenuItem').style.display='none'; }
    });
  </script>
  <script src=""></script>
</body>
</html>
